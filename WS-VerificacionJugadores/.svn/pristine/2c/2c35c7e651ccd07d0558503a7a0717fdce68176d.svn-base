package es.gob.cnjuego.ws.dao;

import java.sql.SQLException;

import javax.naming.NamingException;

import oracle.ucp.jdbc.PoolDataSourceImpl;

import org.springframework.jndi.JndiObjectFactoryBean;

/**
 * Esta clase es un factory que permite sobreescribir el usuario y la contraseña
 * de la conexión de la base de datos. De esta forma, tenemos la definición centralizada
 * del datasource en el servidor (server.xml), configurada para usar un pool de conexiones y
 * cada aplicación utiliza su propio usuario/contraseña para conectarse.
 * Nótese que este factory se invoca una vez solamente, cuando la aplicación arranca.
 */
public class CustomJndiObjectFactoryBean extends JndiObjectFactoryBean {

	public void afterPropertiesSet() throws IllegalArgumentException, NamingException {

		super.afterPropertiesSet();
		Object jndiDatasource = getObject();
		try {
			if (jndiDatasource instanceof PoolDataSourceImpl) {
				((PoolDataSourceImpl) jndiDatasource).setUser("CNJ03");
				((PoolDataSourceImpl) jndiDatasource).setPassword("CN003pru");
			}
		} catch (SQLException e) {
			throw new IllegalArgumentException("Error con el usuario y la contraseña");
		}
	}

}
